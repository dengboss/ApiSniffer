# ApiSniffer

API接口抓包工具 - 基于mitmproxy的网络流量分析工具

## 功能特性

- 🔍 实时抓取HTTP/HTTPS API请求和响应
- 📊 数据表格化显示，支持导出Excel
- 🎯 支持域名过滤，只监听指定域名
- 🖥️ 友好的图形界面，操作简单
- 📝 自动保存抓取数据到JSON文件

## 快速开始

### 1. 启动应用
```bash
python main.py
```

### 2. 解决代理问题（如果遇到）
如果点击"开始监听"没有反应，或访问 `http://mitm.it/` 显示错误，请运行：
```bash
python fix_proxy.py
```

### 3. 配置浏览器代理
- 代理地址：`127.0.0.1`
- 端口：`8080`

### 4. 安装证书
1. 确保代理已启动
2. 访问 `http://mitm.it/`
3. 下载并安装对应系统的证书

## 问题解决

### 常见问题1：点击"开始监听"没有反应
**原因**：端口被占用或mitmdump进程异常

**解决方案**：
```bash
# 方法1：运行修复脚本
python fix_proxy.py

# 方法2：手动终止进程
taskkill /F /IM mitmdump.exe
```

### 常见问题2：访问mitm.it显示错误
**错误信息**：`If you can see this, traffic is not passing through mitmproxy.`

**原因**：浏览器代理配置不正确

**解决方案**：
1. 确认代理服务器已启动（状态栏显示"运行中"）
2. 检查浏览器代理设置：127.0.0.1:8080
3. 尝试重启浏览器

### 常见问题3：无法抓取HTTPS流量
**原因**：未安装mitmproxy证书

**解决方案**：
1. 配置代理后访问 `http://mitm.it/`
2. 下载证书并安装到"受信任的根证书颁发机构"
3. 重启浏览器

## 文件说明

- `main.py` - 主程序入口
- `ui.py` - 图形界面
- `proxy_listener.py` - 代理服务器管理
- `mitm_writer.py` - mitmproxy脚本
- `data_processor.py` - 数据处理
- `fix_proxy.py` - 问题修复脚本
- `test_proxy.py` - 代理测试脚本
- `代理配置说明.md` - 详细配置说明

## 使用技巧

1. **域名过滤**：在输入框中输入要监听的域名，多个域名用逗号分隔
2. **数据导出**：点击"导出Excel"保存数据
3. **清除数据**：点击"清除数据"清空所有记录
4. **自动刷新**：应用会每2秒自动刷新显示新抓取的数据

## 注意事项

⚠️ **重要提醒**：
- 仅用于合法的API调试和测试
- 使用完毕后记得关闭浏览器代理设置
- 抓取的数据可能包含敏感信息，请妥善保管
- 不要在生产环境中使用此工具

## 技术栈

- Python 3.x
- PyQt5 - 图形界面
- mitmproxy - 代理服务器
- pandas - 数据处理
- requests - HTTP客户端