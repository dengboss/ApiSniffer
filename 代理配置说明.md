# API抓包工具 - 代理配置说明

## 问题解决

如果点击"开始监听"没有反应，或者访问 `http://mitm.it/` 提示 "If you can see this, traffic is not passing through mitmproxy"，请按照以下步骤操作：

## 1. 启动代理服务器

1. 运行 `python main.py` 启动应用程序
2. 点击"开始监听"按钮
3. 如果成功，会显示提示信息：
   ```
   代理服务器已启动，请在设备上设置代理：
   IP地址: 127.0.0.1
   端口: 8080
   ```

## 2. 配置浏览器代理

### Chrome/Edge 浏览器配置：

1. 打开浏览器设置
2. 搜索"代理"或"proxy"
3. 点击"打开您计算机的代理设置"
4. 在"手动代理设置"中：
   - 开启"使用代理服务器"
   - 地址：`127.0.0.1`
   - 端口：`8080`
5. 点击"保存"

### Firefox 浏览器配置：

1. 打开 Firefox 设置
2. 搜索"代理"
3. 点击"设置..."按钮
4. 选择"手动代理配置"
5. HTTP 代理：`127.0.0.1`，端口：`8080`
6. 勾选"也将此代理用于 HTTPS"
7. 点击"确定"

## 3. 安装证书（重要！）

配置代理后，必须安装 mitmproxy 证书才能抓取 HTTPS 流量：

1. 确保代理已启动并且浏览器已配置代理
2. 在浏览器中访问：`http://mitm.it/`
3. 如果看到 mitmproxy 证书下载页面，说明代理配置成功
4. 点击对应操作系统的证书下载链接
5. 安装证书到"受信任的根证书颁发机构"

## 4. 验证配置

1. 访问 `http://mitm.it/` 应该看到证书下载页面
2. 访问任何网站，应用程序中应该开始显示抓取的数据
3. 如果仍然看到 "If you can see this, traffic is not passing through mitmproxy"，说明代理配置有问题

## 5. 常见问题解决

### 问题1：端口被占用
如果启动时提示端口被占用：
```bash
# 查看占用端口的进程
netstat -ano | findstr :8080

# 终止占用进程（替换PID为实际进程ID）
taskkill /PID <PID> /F
```

### 问题2：mitmdump 启动失败
确保 `mitmdump.exe` 文件存在于项目目录中，或者安装 mitmproxy：
```bash
pip install mitmproxy
```

### 问题3：无法抓取数据
1. 确认代理配置正确
2. 确认证书已安装
3. 尝试访问 HTTP 网站（不是 HTTPS）进行测试
4. 检查域名过滤设置

## 6. 测试代理

运行测试脚本验证代理是否正常工作：
```bash
python test_proxy.py
```

## 7. 使用技巧

1. **域名过滤**：在"只监听域名"输入框中输入要监听的域名，用逗号分隔
2. **数据导出**：点击"导出Excel"按钮将抓取的数据保存为Excel文件
3. **清除数据**：点击"清除数据"按钮清空所有抓取的数据
4. **停止监听**：使用完毕后记得点击"停止监听"按钮

## 8. 注意事项

- 使用完毕后记得关闭浏览器代理设置
- 不要在生产环境中使用此工具
- 仅用于合法的API调试和测试
- 抓取的数据可能包含敏感信息，请妥善保管